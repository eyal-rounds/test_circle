test:
  pre:
    - env|sort
    - cat ~/.rounds_cache/build_count

  override:
    - ./gradlew assembleRelease
    - cp -r app/build/outputs/* $CIRCLE_ARTIFACTS
dependencies:
  pre:
   - chmod a+z ./scripts/make_build_count.sh
   - ./scripts/make_build_count.sh
  cache_directories:
    - ~/.rounds_cache/
deployment:
  production:
    branch: master
    commands:
      - file=$(ls $CIRCLE_ARTIFACTS/apk/*release*.apk|grep -vi unaligned)
      - aws s3 cp $file s3://rounds-android-develop/app-release_${CIRCLE_SHA1}.apk
  staging:
    branch: develop
    commands:
      - echo deploy develop